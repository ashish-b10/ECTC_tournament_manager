{% extends "tmdb/base.html" %}

{% load bootstrap %}

{% block main-content %}
  <div class="row page-header">
    <h1 class="col-sm-5 col-md-5">ECTC Tournaments</h1>
    {% if perms.tmdb.add_tournament %}
    <a class="col-sm-offset-2 col-sm-3 col-md-offset-3 col-md-3 btn btn-primary" id="createTournamentButton" href="{%url 'tmdb:tournament_add'%}" >Create New Tournament</a>
    {% endif %}
  </div>

  <table class="table table-striped">
    <thead>
      <th>Tournament Location</th>
      <th>Date</th>
      <th>Details</th>
      <th>Schools</th>
      {% if perms.tmdb.delete_tournament %}
      <th>Delete</th>
      {% endif %}
    </thead>
  {% if tournaments %}
    {% for tournament in tournaments %}
    <tr>
      <td><a href="{% url 'tmdb:tournament_dashboard' tournament.slug %}">{{tournament.location}}</a></td>
      <td>{{tournament.date}} </td>
      <td><a class="btn btn-default" href="{% url 'tmdb:tournament_change' tournament.slug %}">Edit</a></td>
      <td>
        {% if tournament.imported %}
          <a class="btn btn-default" href="{% url 'tmdb:tournament_schools' tournament.slug %}">Import</a>
        {% else %}
          <p>Need to add schools.</p>
        {% endif %}
      </td>
      <td>
        {% if perms.tmdb.delete_tournament %}
        <button type="button" class="btn btn-danger" data-toggle="modal" data-target="#confirmDeleteTournamentModal{{tournament.id}}">Delete</button>
        {% endif %}
        <!-- Modal to confirm that you want to delete -->
        <div class="modal" id="confirmDeleteTournamentModal{{tournament.id}}" role="dialog" tabindex="-1">
          <div class="modal-dialog" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="deleteTournamentModalLabel">Delete Tournament</h4>
              </div>
              <div class="modal-body">
                <p> Are you sure you want to delete this tournament ({{tournament.location}} {{tournament.date}})? </p>
              </div>
              <div class="modal-footer">
                <form action="{% url 'tmdb:tournament_delete' tournament.slug %}" method="post">
                    {% csrf_token %}
                    {{ delete_form }}
                    <button type="submit" class="btn btn-danger">Delete Tournament</button>
                </form>
              </div>
            </div>
          </div>
        </div>
      </td>
    </tr>
    {% endfor %}
  {% else %}
  <tr><td>There are no existing tournaments in the database.</td></tr>
  {% endif %}
  </table>
{% endblock %}
